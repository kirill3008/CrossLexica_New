PROGRAM SINGMUL2;

USES DOS, CLASTABL;

  TYPE
    STR3 = STRING [3];
    STR5 = STRING [5];
    STR6 = STRING [6];
    STR15 = STRING [15];
    STR45 = STRING [55];
    STR115 = STRING [115];
  CONST
    BL = ' ';
    HY = '-';
    DUMMY = '';
    MAXNOUN = 42000; 
    
{ List of SINGL-PLUR or PLUR-SINGL endings of the same length }
    MAX0 = 28;
    NUMB_PAIRS0 : ARRAY [1..MAX0, 1..2] OF STR3 =
(*01*)(('',     ''),     (*  *)
(*02*) ('',     ''),     (*  *)
(*03*) ('',     ''),     (*  *)
(*04*) ('',     ''),     (*  *)
(*05*) ('',    ''),    (*  *)
(*06*) ('',    ''),    (*  *)
(*07*) ('',    ''),    (*  *)
(*08*) ('',     ''),     (*  *)
(*09*) ('',     ''),     (*  *)
(*10*) ('',    ''),    (*  *)
(*11*) ('',    ''),    (*  *)
(*12*) ('',    ''),    (*  *)
(*13*) ('',    ''),    (*  *)
(*14*) ('',    ''),    (*  *)
(*15*) ('',     ''),     (*  *)
(*16*) ('',     ''),     (*  *)
(*17*) ('',     ''),     (*  *)
(*18*) ('',     ''),     (*  *)
(*19*) ('',   ''),   (*  *)
(*20*) ('',    ''),    (*  *)
(*21*) ('',    ''),    (*  *)
(*22*) ('',    ''),    (*  *)
(*23*) ('',    ''),    (*  *)
(*24*) ('',    ''),    (*  *)
(*25*) ('',    ''),    (*  *)
(*26*) ('',    ''),    (*  *)
(*27*) ('',    ''),    (*  *)
(*28*) ('',     ''));    (*  *)

{ List of SINGL-PLUR or PLUR-SINGL endings of different lengths }
  MAX1 = 27;
  NUMB_PAIRS1 : ARRAY [1..MAX1, 1..2] OF STRING [4] =
(*01*)(('',      ''),     (*  *)
(*02*) ('',      ''),     (*  *)
(*03*) ('',      ''),  (*  *)
(*04*) ('',      ''),     (*  *)
(*05*) ('',      ''),    (*  *)
(*06*) ('',     ''),    (*  *)
(*07*) ('',     ''),    (*  *)
(*08*) ('',   ''),  (*  *)
(*09*) ('',     ''),   (*  *)
(*10*) ('',     ''),    (*  *)
(*11*) ('',    ''),   (*  *)
(*12*) ('',   ''),    (*  *)
(*13*) ('',    ''),   (*  *)
(*14*) ('',    ''),   (*  *)
(*15*) ('',    ''),   (*  *)
(*16*) ('',    ''),   (*  *)
(*17*) ('',   ''),     (*  *)
(*18*) ('',  ''),   (*  *)
(*19*) ('',   ''),    (*  *)
(*20*) ('',   ''),     (*  *)
(*21*) ('',    ''),   (*  *)
(*22*) ('',    ''),   (*  *)
(*23*) ('',    ''),     (*  *)
(*24*) ('',   ''),    (*  *)
(*25*) ('',    ''),   (*  *)
(*26*) ('',     ''),    (*  *)
(*27*) ('',   ''));   (*  *)

  VAR
    LI, LJ, K, Q, CLASS : INTEGER;
    I, J, PAIRSAMT, N_REACHED : LONGINT; 
    OUT : TEXT;
    FOUND, VALID : BOOLEAN;
    NUMB : NUMBER;
    GEND : GENDER;
    ANIM : ANIMA;
    TOKI, TOKJ : STR45;
    FINI, FINJ : STR5;
    NOUN : ARRAY [1..MAXNOUN] OF STR45;

{ Listing of false SINGL-PLUR pairs of the same lengths }
FUNCTION FORBID_PAIR0 (TOK1, TOK2 : STR45) : BOOLEAN;
       (*============*)
CONST 
  FORBID_MAX0 = 92;
  T : ARRAY [1..FORBID_MAX0, 1..2] OF STR45 =
(('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''));
VAR 
  I : INTEGER; 
  FOUND : BOOLEAN;
BEGIN
  FOUND := FALSE;
  I := 0;
  REPEAT 
    INC(I); 
    FOUND := (TOK1 = T[I,1]) AND (TOK2 = T[I,2]);
  UNTIL FOUND OR (I = FORBID_MAX0);
  FORBID_PAIR0 := FOUND;
END;

{ Listing of false SINGL-PLUR pairs of differen lengths }
FUNCTION FORBID_PAIR1 (TOK1, TOK2 : STR45) : BOOLEAN;
       (*============*)
CONST 
  FORBID_MAX1 = 114;
  T : ARRAY [1..FORBID_MAX1, 1..2] OF STR45 =
(('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''),
 ('',''));
VAR 
  I : INTEGER; 
  FOUND : BOOLEAN;
BEGIN
  FOUND := FALSE;
  I := 0;
  REPEAT 
    INC(I); 
    FOUND := (TOK1 = T[I,1]) AND (TOK2 = T[I,2]);
  UNTIL FOUND OR (I = FORBID_MAX1);
  FORBID_PAIR1 := FOUND;
END;

{ Initialization of basic nouns array }
PROCEDURE FILL_NOUNS;
        (*===========*)
VAR
  I : LONGINT;
  LINE, TMP : STR115;
  INP : TEXT;
BEGIN
  ASSIGN (INP, 'SUBSTAT3.STS');
  RESET (INP);
  I := 0;
  REPEAT
    READLN (INP, LINE);
    TMP := COPY (LINE, 6, LENGTH(LINE)-5);
    IF (POS(TMP[1], '0123456789^"') = 0) AND (POS ('<', TMP) = 0)  
      AND (POS (BL, TMP) = 0) AND (POS (HY, TMP) = 0)
      AND (POS(TMP[LENGTH(TMP)], '0123456789') = 0) 
      THEN
        BEGIN
          INC(I);
          NOUN [I] := COPY (LINE, 6, LENGTH(LINE)-5);
        END;
  UNTIL EOF(INP) OR (I = MAXNOUN);
  N_REACHED := I;
  CLOSE (INP);
  writeln ('NOUNS are ', N_REACHED);
END;


BEGIN  (* MAIN *)
  FILL_NOUNS;

  ASSIGN (OUT, 'PAIRS2.DAT');
  REWRITE (OUT);

  PAIRSAMT := 0;

  FOR I := 1 TO N_REACHED - 1 DO
    BEGIN
      TOKI := NOUN [I];
      LI := LENGTH (TOKI);
      FOR J := I+1 TO N_REACHED DO
        BEGIN
          TOKJ := NOUN [J];
          LJ := LENGTH (TOKJ);

          IF (TOKI[1] = TOKJ[1])
            THEN
              IF (LI = LJ)
                THEN
                  BEGIN
                    FOUND := FALSE;
                    K := 1;
                    WHILE (TOKI[K] = TOKJ[K]) DO
                      INC(K);
                    FINI := COPY (TOKI, K, LI-K+1);
                    FINJ := COPY (TOKJ, K, LJ-K+1);
                    
                    Q := 0;
                    REPEAT
                      INC(Q);
                      FOUND := (FINI = NUMB_PAIRS0[Q,1]) 
                        AND (FINJ = NUMB_PAIRS0[Q,2]); 
                    UNTIL FOUND OR (Q = MAX0);  
                    
                    IF FOUND 
                      AND NOT FORBID_PAIR0 (TOKI, TOKJ)
                      THEN
                        BEGIN
                          INITSUBCL (TOKI, CLASS, VALID, NUMB, GEND, ANIM);
                 {   IF (TOKI = '') THEN WRITELN (' = ', ORD(NUMB));}
                          IF NUMB = SING
                            THEN WRITELN (OUT, '1 ', TOKI, BL:2, TOKJ)
                            ELSE WRITELN (OUT, '1 ', TOKJ, BL:2, TOKI);
                          INC (PAIRSAMT);
                        END;
                  END
                ELSE
                  BEGIN
                    FOUND := FALSE;
                    K := 1;
                    WHILE (TOKI[K] = TOKJ[K]) AND (K <= LI) DO
                      INC(K);
                  {  IF K = LI
                      THEN FINI := ''
                      ELSE } FINI := COPY (TOKI, K, LI-K+1);
                    FINJ := COPY (TOKJ, K, LJ-K+1);
                    Q := 0;
                    REPEAT
                      INC(Q);
                      FOUND := (FINI = NUMB_PAIRS1[Q,1]) 
                        AND (FINJ = NUMB_PAIRS1[Q,2]); 
                    UNTIL FOUND OR (Q = MAX1);  
 
                    IF FOUND 
                      AND NOT FORBID_PAIR1 (TOKI, TOKJ)
                      THEN  
                        BEGIN  
                          INITSUBCL (TOKI, CLASS, VALID, NUMB, GEND, ANIM);
                          IF NUMB = SING
                            THEN WRITELN (OUT, '1 ', TOKI, BL:2, TOKJ)
                            ELSE WRITELN (OUT, '1 ', TOKJ, BL:2, TOKI);
                          INC (PAIRSAMT);
                        END;
                  END;
        END;
    END;

  FLUSH (OUT);

  WRITELN ('File PAIRS2.DAT contains ', PAIRSAMT, ' pairs');
END.
